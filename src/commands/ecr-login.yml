description: "Authenticate into the Amazon ECR service"

parameters:
  registry-id:
    type: env_var_name
    default: AWS_ACCOUNT_ID
    description: >
      The 12 digit AWS id associated with the ECR account.
      This field is required

  region:
    type: string
    default: ${AWS_DEFAULT_REGION}
    description: >
      AWS region of ECR repository. Defaults to environment variable ${AWS_DEFAULT_REGION}

  profile-name:
    type: string
    default: "default"
    description: >
      AWS profile name to be used for login.

  public-registry:
    type: boolean
    description: Set to true if building and pushing an image to a Public Registry on ECR.
    default: false

steps:
  - run:
      name: Log into Amazon ECR with profile <<parameters.profile-name>>
      environment:
        ORB_VAL_PROFILE_NAME: <<parameters.profile-name>>
        ORB_ENV_REGISTRY_ID: <<parameters.registry-id>>
        ORB_EVAL_REGION: <<parameters.region>>
        ORB_VAL_PUBLIC_REGISTRY: <<parameters.public-registry>>
      command: <<include(scripts/ecr-login.sh)>>
